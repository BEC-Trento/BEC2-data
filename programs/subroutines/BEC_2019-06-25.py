prg_comment = ""
prg_version = "0.7"
def program(prg, cmd):
    prg.add(0, "Initialize 0 TTL and Synchronize.sub")
    prg.add(50000, "Switch Off MOT")
    prg.add(60000, "[test] Degauss_1012")
    prg.add(12060000, "Set_MOT")
    prg.add(92060000, "Switch Off MOT_fast")
    prg.add(92061250, "GM_051018")
    prg.add(92063150, "DAC MT-MOT Current", 0.0000, functions=dict(value=lambda x: cmd.get_var('MT_I')))
    prg.add(92063649, "DAC MT-MOT Voltage", 0.0000, functions=dict(value=lambda x: cmd.get_var('MT_Voltage')))
    prg.add(92073000, "Oscilloscope Trigger ON", enable=False)
    prg.add(92116750, "wait")
    prg.add(92117750, "Config Field MT-MOT")
    prg.add(92118750, "DAC Horiz IR", 0.0000, functions=dict(value=lambda x: cmd.get_var('CigarV')))
    prg.add(92119250, "AOM IR Horizontal Amp", 1000)
    prg.add(92119750, "AOM IR Horizontal freq", 80.00)
    prg.add(92120250, "DAC Vert IR", 1.0000)
    prg.add(92120750, "AOM IR Vertical Amp", 1000)
    prg.add(92121250, "AOM IR Vertical freq", 80.00)
    prg.add(92122500, "IGBT BCompY CLOSE")
    prg.add(92122750, "Oscilloscope Trigger ON", enable=False)
    prg.add(92122750, "Oscilloscope Trigger OFF", enable=False)
    prg.add(92123500, "DAC BCompY", 0.4160, functions=dict(value=lambda x: cmd.get_var('BCompY_value')*30.0/18.))
    prg.add(92622750, "DAC MT-MOT Voltage", 8.5000)
    prg.add(92623750, "Evaporation Ramp.sub", enable=False)
    prg.add(94123750, "MT Current Ramp", start_t=0, stop_x=0, n_points=100, start_x=24, stop_t=500, functions=dict(start_x=lambda x: cmd.get_var('MT_I'), stop_x=lambda x: cmd.get_var('MT_I_final')))
    prg.add(94124500, "BCompY current ramp", start_t=0, stop_x=0.15, n_points=100, start_x=0.416, stop_t=500, functions=dict(start_x=lambda x: cmd.get_var('BCompY_value')*30.0/18., stop_x=lambda x: cmd.get_var('BCompY_value')*50.0/18.))
    prg.add(132623750, "MT Current Ramp", start_t=0, stop_x=18, n_points=500, start_x=0, stop_t=3000, functions=dict(start_x=lambda x: cmd.get_var('MT_I_final')))
    prg.add(132624750, "BCompY current ramp", start_t=0, stop_x=0, n_points=500, start_x=0, stop_t=3000, functions=dict(start_x=lambda x: cmd.get_var('BCompY_value')*50.0/18., stop_x=lambda x: cmd.get_var('BCompY_value')))
    prg.add(132624750, "MT Current HalfGauss ramp", start_t=0.0000, func_args="a=50, b=18, duration=3, width=2", n_points=500, func="(a - b * exp(-duration**2 / width**2)) / (1 - exp(-duration**2 / width**2)) + ((b - a) / (1 - exp(-duration**2 / width**2))) * exp(-(t - duration)**2 / width**2)", stop_t=3000.0000, functions=dict(func_args=lambda x: "a={}, b=18, duration=3000, width=1".format(cmd.get_var('MT_I_final')), funct_enable=False), enable=False)
    prg.add(132723500, "Oscilloscope Trigger ON", enable=False)
    prg.add(162725750, "Horizontal Dipole Evaporation Ramp_5V_2019_03")
    prg.add(195226750, "wait")
    return prg
